<!-- KOEN VAN DER KAMP COMMENT -->
<!DOCTYPE html>
<html>
  <head>

      <link rel="stylesheet" href="problem3.css">
    <title>
      Graph for problem 3
    </title>
  </head>
  <body>
    <p>
      Javescript intro: by Koen van der Kamp 12466573
      link to data <a href="https://www.kaggle.com/heesoo37/120-years-of-olympic-history-athletes-and-results">here</a><br>
      <b>Gold medals achieved every year by the dutch olympic teams</b><br>
      Hover over the datapoints for more information<br>
    </p>
    <canvas id="canvas" width="1000" height="500"></canvas>
    <canvas id="overlay" width="1000" height="500"></canvas>
    <script type="text/javascript">
      var fileName = "output.json";
      var txtFile = new XMLHttpRequest();
      txtFile.onreadystatechange = function() {
          if (txtFile.readyState === 4 && txtFile.status == 200) {
              console.log(JSON.parse(txtFile.responseText));

              // process the data a little (what country?)
              let datalist = process(txtFile)

              // graph the data produce a list of invisible rectangles for the data points
              let rectangles = graph(datalist.golds, datalist.events)

              // add the interactive element
              interactive(rectangles)

              }
          }
      txtFile.open("GET", fileName);
      txtFile.send();
      function createTransform(domain, range)
      {
        var domainMin = domain[0]
        var domainMax = domain[1]
        var rangeMin = range[0]
        var rangeMax = range[1]
        var increment = (rangeMax - rangeMin) / (domainMax - domainMin)
        return function(x)
        {
          return (((x - domain[0]) * increment) + range[0]);
        }

      }
      function process(txtFile)
      {
        // produce variables where everything will be stored in
        var gold = {}
        var events = {}
        JSON.parse(txtFile.responseText).forEach(function(data)
        {
          if(data.NOC === 'NED' && data.Medal === 'Gold')
          {
            gold[data.Year] = (gold[data.Year] + 1) || 1;
            events[data.Year] ? events[data.Year].push(data.Event) : events[data.Year] = [data.Event]

        }
      })
        console.log(events)
        return {golds: gold, events: events}
      }
      function graph(gold, events)
      {
        // Produce the canvass and types
        var canvas = document.getElementById('canvas');
        var crc = canvas.getContext('2d');
        crc.strokeStyle = 'black'
        crc.font = "15px Arial";
        crc.textAlign = "center";

        // basic layout of a graph
        crc.beginPath();
        crc.moveTo(50, 450);
        crc.lineTo(1000, 450);
        crc.moveTo(50, 50);
        crc.lineTo(50, 450);
        crc.stroke();
        crc.beginPath();

        // produce an empty rectangle array for the interactive part
        var rectangles = []

        console.log(typeof(gold))
        // domain and range variables
        let goldsmax = Math.max(...Object.values(gold))
        let goldsmin = Math.min(...Object.values(gold))
        let yearmin = Math.min(...Object.keys(gold))
        let yearmax = Math.max(...Object.keys(gold))


        // produce the nessesary transforms for the graph
        var ytransform = createTransform([0, goldsmax], [50,450]);
        var xtransform = createTransform([yearmin, yearmax], [50,1000])

        // draw the graph
        for (var key in gold)
        {
          y = ytransform(gold[key]);
          x = xtransform(parseInt(key));
          y = Math.abs(y - 500);
          crc.lineTo(x, y);
          rectangles.push({id: key, xco: x - 7, yco: y - 7, w: 15, h:15});
          var div = document.createElement('div');
          div.id = key
          div.style.top = y + 'px';
          div.style.left = x + 30 + 'px';
          eventlist = events[key];
          string = 'Year ' + key + ':\r\n'
          for (var i = 0; eventlist[i]; i++)
          {
            string = string + eventlist[i] + '\r\n'
          }
          div.textContent = string
          document.body.appendChild(div);
        }
        crc.stroke();

        // x axis labels
        for (i = yearmin; i <= yearmax; i = i + 10)
        {
          crc.fillText(i, xtransform(i), 465)
        }

        for (i = 0; i <= goldsmax; i = i + parseInt((goldsmax - goldsmin) / 10))
        {
          x = 0
          y = Math.abs(ytransform(i) - 500);
          crc.globalAlpha = 0.1
          crc.beginPath()
          crc.moveTo(x + 50, y)
          crc.lineTo(1000, y)
          crc.stroke()
          crc.globalAlpha = 1
          crc.fillText((i), x + 30, y)
        }
        // produce the x axis <label>
        crc.fillText("year of participation", 500, 498)
        // produce the y axis label
        crc.save();
        crc.translate(15 , 300);
        crc.rotate(-1 * (Math.PI/2));
        crc.fillText("amount of gold medals", 0, 0);
        crc.restore();
        return rectangles
      }
      function interactive(rectangles)
      {
        var canvas = document.getElementById('overlay')
        var over = canvas.getContext('2d')

        overlay.onmousemove = function(e) {
        clientRect = this.getBoundingClientRect()
        let x = e.clientX - clientRect.x
        let y = e.clientY - clientRect.y
        if (x < 50) { x = 50}
        let  i = 0;
        currentid = undefined
        clearTimeout(x)
        while(rectangles[i])
        {
          over.beginPath();
          over.rect(rectangles[i].xco, rectangles[i].yco, rectangles[i].w, rectangles[i].h)
          let id = rectangles[i].id
          if (over.isPointInPath(x, y))
          {
          x = setTimeout(drawinformation, 1000, id);
          }
          else
          {
            document.getElementById(id).style.visibility = 'hidden'
          }
          i++
        }


      }
    }
    function drawinformation(id)
    {
      document.getElementById(id).style.visibility = 'visible';
    }


    </script>
  </body>
</html>
